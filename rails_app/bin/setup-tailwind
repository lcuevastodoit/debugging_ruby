#!/usr/bin/env bash

# Setup script for Tailwind CSS in Rails application
# This script installs all necessary dependencies and configures Tailwind CSS

set -e # Exit on error

echo "🚀 Setting up Tailwind CSS for Rails application"

echo "📦 Installing JavaScript dependencies..."
if command -v yarn &> /dev/null; then
  yarn add tailwindcss@3.3.2 postcss@8.4.24 autoprefixer@10.4.14 postcss-import@15.1.0
elif command -v npm &> /dev/null; then
  npm install tailwindcss@3.3.2 postcss@8.4.24 autoprefixer@10.4.14 postcss-import@15.1.0 @tailwindcss/forms @tailwindcss/typography @tailwindcss/aspect-ratio
else
  echo "❌ Error: Neither yarn nor npm is installed. Please install one of them to continue."
  exit 1
fi

echo "📁 Creating necessary directories..."
mkdir -p app/assets/builds
touch app/assets/builds/.keep

echo "🔄 Setting permissions for bin scripts..."
chmod +x bin/dev
chmod +x bin/tailwindcss

echo "🏗️ Building Tailwind CSS..."
if command -v yarn &> /dev/null; then
  yarn build:css
else
  npm run build:css
fi

echo "✅ Tailwind CSS setup complete!"
echo "Run 'bin/dev' to start the development server"